!function(t,e){"use strict";var r=function(t){throw"ngDonut: "+t};"undefined"==typeof t&&r("Angular is a required library: https://angularjs.org/"),"undefined"==typeof e&&r("D3 is a required library: http://d3js.org/"),t.module("ngDonut",[]).directive("donut",function(){return{restrict:"EA",require:"ngModel",scope:{dataset:"=ngModel",height:"=",width:"=",radius:"=",colours:"=",property:"=",stroke:"=",strokeWidth:"=",mousemove:"&",mouseleave:"&"},controller:["$scope",function(t){var r=e.scale.category20();t.currentAngles={},t.getColour=function(e){return t.colours&&t.colours.length>e?t.colours[e]:r(e)},t.getTranslate=function(){return"translate("+t.getWidth()/2+","+t.getHeight()/2+")"},t.getWidth=function(){return t.width||400},t.getHeight=function(){return t.height||400},t.getRadius=function(){return t.radius||Math.min(t.getWidth(),t.getHeight())/2},t.clean=function(e){return e.map(function(e){return t.property?(e[t.property]=isNaN(Number(e[t.property]))?0:Number(e[t.property]),e):isNaN(Number(e))?0:Number(e)})},t.tweenArc=function(e){var r=d3.svg.arc().innerRadius(t.getRadius()-100).outerRadius(t.getRadius()-20),n=d3.interpolate(this._current,e);return this._current=n(0),function(t){return r(n(t))}},t.computePointer=function(r){var n=e.mouse(r),o=n[0]+t.getWidth()/2,i=n[1]+t.getHeight()/2;return[o,i]},t.listenForEvents=function(e){t.mousemove&&e.on("mousemove",function(e){var r=e.data;r.pointer=t.computePointer(this),t.mousemove({model:e.data}),t.$apply()}),t.mouseleave&&e.on("mouseleave",function(){t.mouseleave({pointer:t.computePointer(this)}),t.$apply()})}}],link:function(t,r){var n,o,i,u,a;t.createDonut=function(){n=Math.min(t.getWidth(),t.getHeight())/2,o=e.layout.pie().sort(null).value(function(e){return t.property?e[t.property]:e}),i=e.svg.arc().innerRadius(n).outerRadius(n-t.getRadius()),u=e.select(r[0]).append("svg").attr("width",t.getWidth()).attr("height",t.getHeight()).append("g").attr("transform",t.getTranslate()),a=u.selectAll("path").data(o(t.clean(t.dataset))).enter().append("path").attr("fill",function(e,r){return t.getColour(r)}).attr("d",i).each(function(t){this._current=t}),t.listenForEvents(a),t.stroke&&a.attr("stroke",t.stroke),t.strokeWidth&&a.attr("stroke-width",t.strokeWidth)},t.tweenArc=function(t){var r=e.interpolate(this._current,t);return this._current=r(0),function(t){return i(r(t))}},t.$watch("dataset",function(){if(0!==t.dataset.length){if(!o)return void t.createDonut();a.data(o(t.clean(t.dataset))),a.transition().duration(750).attrTween("d",t.tweenArc)}},!0)}}})}(window.angular,window.d3);